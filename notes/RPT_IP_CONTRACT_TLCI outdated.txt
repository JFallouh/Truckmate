CREATE OR REPLACE PROCEDURE RPT_IP_CONTRACT_TLCI (
  IN LEG_ID INTEGER
)
LANGUAGE SQL
SPECIFIC SP_RPT_IP_CONTRACT_TLCI
DYNAMIC RESULT SETS 1
BEGIN
  DECLARE S_LEG_ID INTEGER;
  DELETE FROM CGTT_TEMP_IPCONT_RSLT;
  SET S_LEG_ID = RPT_IP_CONTRACT_TLCI.LEG_ID;
  FOR C1 AS
    SELECT 
      L.LS_LEG_ID,
      L.LS_LEG_SEQ,
      L.LS_PLANNED_DEPARTURE,
      L.LS_EXPECTED_DATE,
      L.LS_NUM_PU,
      L.LS_NUM_DEL,
      L.LS_INTERLINER,
      OZ.IS_TERMINAL TERM_ORIG, 
      OZ.SHORT_DESCRIPTION TERM_ORIGNAME,
      OZ.ADDRESS1 TERM_ORIGADDR1,
      OZ.ADDRESS2 TERM_ORIGADDR2,
      OZ.CITY TERM_ORIGCITY,
      OZ.PROVINCE TERM_ORIGPROV,
      OZ.POSTAL_CODE TERM_ORIGPC,      
      DZ.IS_TERMINAL TERM_DEST, 
      DZ.SHORT_DESCRIPTION TERM_DESTNAME,
      DZ.ADDRESS1 TERM_DESTADDR1,
      DZ.ADDRESS2 TERM_DESTADDR2,
      DZ.CITY TERM_DESTCITY,
      DZ.PROVINCE TERM_DESTPROV,
      DZ.POSTAL_CODE TERM_DESTPC
    FROM 
      LEGSUM L 
      INNER JOIN ZONE OZ ON OZ.ZONE_ID = L.LS_FROM_ZONE
      INNER JOIN ZONE DZ ON DZ.ZONE_ID = L.LS_TO_ZONE
    WHERE
      L.LS_LEG_ID = S_LEG_ID
    WITH UR
  DO
    IF COALESCE(TERM_ORIG,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          D.DESCRIPTION,
          D.PIECES,
          D.PALLETS,
          D.WEIGHT,
          D.WEIGHT_UNITS,
          D.LENGTH_1,
          D.LENGTH_UNITS,    
          D.WIDTH,
          D.WIDTH_UNITS,    
          D.HEIGHT,
          D.HEIGHT_UNITS,
          D.CUBE,
          D.CUBE_UNITS,  
          D.TEMPERATURE,          
          D.TEMP_CONTROLLED,
          D.TEMPERATURE_UNITS,
          T.TARP,
          T.HIGH_VALUE,
          T.DANGEROUS_GOODS,
          C.CUSTOMS_NAME,
          C.CUSTOMS_PHONE,    
          C.CUSTOMS_FAX,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          1 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          LEFT OUTER JOIN TLDTL D ON D.ORDER_ID = T.DETAIL_LINE_ID AND D.PICK_ID = 0 AND D.DEFICIT = 0
          LEFT OUTER JOIN TLORDER_CUSTOMS C ON C.DETAIL_LINE_ID = T.DETAIL_LINE_ID AND (C.DEFAULT_BROKER = 'True') 
        WHERE
          I.ILD_LEG_ID = S_LEG_ID
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MIN(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'P' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C1.LS_PLANNED_DEPARTURE,
          C1.LS_PLANNED_DEPARTURE,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          C1.TERM_ORIGNAME,
          C1.TERM_ORIGADDR1,
          C1.TERM_ORIGADDR2,
          C1.TERM_ORIGCITY,
          C1.TERM_ORIGPROV,
          C1.TERM_ORIGPC, 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          C2.PIECES,
          C2.PALLETS,
          C2.WEIGHT,
          C2.WEIGHT_UNITS,
          C2.LENGTH_1,
          C2.LENGTH_UNITS,    
          C2.WIDTH,
          C2.WIDTH_UNITS,    
          C2.HEIGHT,
          C2.HEIGHT_UNITS,
          C2.CUBE,
          C2.CUBE_UNITS,  
          C2.TEMPERATURE,
          C2.TEMP_CONTROLLED,
          C2.TEMPERATURE_UNITS,
          C2.TARP,
          C2.HIGH_VALUE,
          C2.DANGEROUS_GOODS,
          C2.CUSTOMS_NAME,
          C2.CUSTOMS_PHONE,    
          C2.CUSTOMS_FAX,
          '',
          '',
          '',
          '',
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          D.DESCRIPTION,
          D.PIECES,
          D.PALLETS,
          D.WEIGHT,
          D.WEIGHT_UNITS,
          D.LENGTH_1,
          D.LENGTH_UNITS,    
          D.WIDTH,
          D.WIDTH_UNITS,    
          D.HEIGHT,
          D.HEIGHT_UNITS,
          D.CUBE,
          D.CUBE_UNITS,  
          D.TEMPERATURE,
          D.TEMP_CONTROLLED,
          D.TEMPERATURE_UNITS,
          T.TARP,
          T.HIGH_VALUE,
          T.DANGEROUS_GOODS,
          C.CUSTOMS_NAME,
          C.CUSTOMS_PHONE,    
          C.CUSTOMS_FAX,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          9999 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          LEFT OUTER JOIN TLDTL D ON D.ORDER_ID = T.DETAIL_LINE_ID AND D.PICK_ID = 0 AND D.DEFICIT = 0
          LEFT OUTER JOIN TLORDER_CUSTOMS C ON C.DETAIL_LINE_ID = T.DETAIL_LINE_ID AND (C.DEFAULT_BROKER = 'True')
        WHERE
          I.ILD_LEG_ID = S_LEG_ID
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MAX(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'D' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C1.LS_EXPECTED_DATE,
          C1.LS_EXPECTED_DATE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          C1.TERM_DESTNAME,
          C1.TERM_DESTADDR1,
          C1.TERM_DESTADDR2,
          C1.TERM_DESTCITY,
          C1.TERM_DESTPROV,
          C1.TERM_DESTPC, 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          C2.PIECES,
          C2.PALLETS,
          C2.WEIGHT,
          C2.WEIGHT_UNITS,
          C2.LENGTH_1,
          C2.LENGTH_UNITS,    
          C2.WIDTH,
          C2.WIDTH_UNITS,    
          C2.HEIGHT,
          C2.HEIGHT_UNITS,
          C2.CUBE,
          C2.CUBE_UNITS,  
          C2.TEMPERATURE,
          C2.TEMP_CONTROLLED,
          C2.TEMPERATURE_UNITS,
          C2.TARP,
          C2.HIGH_VALUE,
          C2.DANGEROUS_GOODS,
          C2.CUSTOMS_NAME,
          C2.CUSTOMS_PHONE,    
          C2.CUSTOMS_FAX,
          '',
          '',
          '',
          '',
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );          
      END FOR;      
    END IF;                    
    IF COALESCE(TERM_ORIG,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          D.DESCRIPTION,
          D.PIECES,
          D.PALLETS,
          D.WEIGHT,
          D.WEIGHT_UNITS,
          D.LENGTH_1,
          D.LENGTH_UNITS,    
          D.WIDTH,
          D.WIDTH_UNITS,    
          D.HEIGHT,
          D.HEIGHT_UNITS,
          D.CUBE,
          D.CUBE_UNITS,  
          D.TEMPERATURE,
          D.TEMPERATURE_UNITS,
          D.TEMP_CONTROLLED,
          T.TARP,
          T.HIGH_VALUE,
          T.DANGEROUS_GOODS,
          C.CUSTOMS_NAME,
          C.CUSTOMS_PHONE,    
          C.CUSTOMS_FAX,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'P' AND X.LD_LEG_ID = S_LEG_ID AND Y.ORIGNAME = T.ORIGNAME AND Y.START_ZONE = T.START_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          LEFT OUTER JOIN TLDTL D ON D.ORDER_ID = T.DETAIL_LINE_ID AND D.PICK_ID = 0 AND D.DEFICIT = 0
          LEFT OUTER JOIN TLORDER_CUSTOMS C ON C.DETAIL_LINE_ID = T.DETAIL_LINE_ID AND (C.DEFAULT_BROKER = 'True') 
        WHERE
          I.LD_PD = 'P' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          C2.LD_PD,
          C2.LD_PD_ORDER,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '' ,
          '' ,
          '' ,
          '' ,
          '' ,
          '' , 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '' ,
          '' ,
          '' ,
          '' ,
          '' ,
          '' , 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          C2.PIECES,
          C2.PALLETS,
          C2.WEIGHT,
          C2.WEIGHT_UNITS,
          C2.LENGTH_1,
          C2.LENGTH_UNITS,    
          C2.WIDTH,
          C2.WIDTH_UNITS,    
          C2.HEIGHT,
          C2.HEIGHT_UNITS,
          C2.CUBE,
          C2.CUBE_UNITS,  
          C2.TEMPERATURE,
          C2.TEMP_CONTROLLED,
          C2.TEMPERATURE_UNITS,
          C2.TARP,
          C2.HIGH_VALUE,
          C2.DANGEROUS_GOODS,
          C2.CUSTOMS_NAME,
          C2.CUSTOMS_PHONE,    
          C2.CUSTOMS_FAX,
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          D.DESCRIPTION,
          D.PIECES,
          D.PALLETS,
          D.WEIGHT,
          D.WEIGHT_UNITS,
          D.LENGTH_1,
          D.LENGTH_UNITS,    
          D.WIDTH,
          D.WIDTH_UNITS,    
          D.HEIGHT,
          D.HEIGHT_UNITS,
          D.CUBE,
          D.CUBE_UNITS,  
          D.TEMPERATURE,
          D.TEMPERATURE_UNITS,
          D.TEMP_CONTROLLED,
          T.TARP,
          T.HIGH_VALUE,
          T.DANGEROUS_GOODS,
          C.CUSTOMS_NAME,
          C.CUSTOMS_PHONE,    
          C.CUSTOMS_FAX,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'D' AND X.LD_LEG_ID = S_LEG_ID AND Y.DESTNAME = T.DESTNAME AND Y.END_ZONE = T.END_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          LEFT OUTER JOIN TLDTL D ON D.ORDER_ID = T.DETAIL_LINE_ID AND D.PICK_ID = 0 AND D.DEFICIT = 0
          LEFT OUTER JOIN TLORDER_CUSTOMS C ON C.DETAIL_LINE_ID = T.DETAIL_LINE_ID AND (C.DEFAULT_BROKER = 'True') 
        WHERE
          I.LD_PD = 'D' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          C2.LD_PD,
          C2.LD_PD_ORDER,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '' ,
          '' ,
          '' ,
          '' ,
          '' ,
          '' , 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '' ,
          '' ,
          '' ,
          '' ,
          '' ,
          '' , 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          C2.PIECES,
          C2.PALLETS,
          C2.WEIGHT,
          C2.WEIGHT_UNITS,
          C2.LENGTH_1,
          C2.LENGTH_UNITS,    
          C2.WIDTH,
          C2.WIDTH_UNITS,    
          C2.HEIGHT,
          C2.HEIGHT_UNITS,
          C2.CUBE,
          C2.CUBE_UNITS,  
          C2.TEMPERATURE,
          C2.TEMP_CONTROLLED,
          C2.TEMPERATURE_UNITS,
          C2.TARP,
          C2.HIGH_VALUE,
          C2.DANGEROUS_GOODS,
          C2.CUSTOMS_NAME,
          C2.CUSTOMS_PHONE,    
          C2.CUSTOMS_FAX,
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );   
      END FOR;      
    END IF;
    IF COALESCE(TERM_ORIG,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,          
          1 STOP_NO,
          R.CONTAINER_NUMBER,
          R.CONTAINER_SIZE,
          R.CONTAINER_TYPE,
          C.NAME CONTAINER_OWNER          
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN CONTAINER_TLORDER R ON R.DLID = T.IM_LOADED
          LEFT OUTER JOIN CLIENT C ON C.CLIENT_ID = R.CONTAINER_OWNER
        WHERE
          I.ILD_LEG_ID = S_LEG_ID 
          AND I.ILD_RES_TYPE = 'F'    
          AND (C1.LS_LEG_SEQ = (SELECT MIN(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'P' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))     
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG,
          CONTAINER_NUMBER,
          CONTAINER_SIZE,
          CONTAINER_TYPE,
          CONTAINER_OWNER
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P0',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C1.LS_PLANNED_DEPARTURE,
          C1.LS_PLANNED_DEPARTURE,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          C1.TERM_ORIGNAME,
          C1.TERM_ORIGADDR1,
          C1.TERM_ORIGADDR2,
          C1.TERM_ORIGCITY,
          C1.TERM_ORIGPROV,
          C1.TERM_ORIGPC, 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          '',
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          '',
          '',
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU,
          C2.CONTAINER_NUMBER,
          C2.CONTAINER_SIZE,
          C2.CONTAINER_TYPE,
          C2.CONTAINER_OWNER
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,           
          9999 STOP_NO,
          R.CONTAINER_NUMBER,
          R.CONTAINER_SIZE,
          R.CONTAINER_TYPE,
          C.NAME CONTAINER_OWNER                    
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN CONTAINER_TLORDER R ON R.DLID = T.IM_LOADED
          LEFT OUTER JOIN CLIENT C ON C.CLIENT_ID = R.CONTAINER_OWNER
        WHERE
          I.ILD_LEG_ID = S_LEG_ID
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MAX(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'D' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG,
          CONTAINER_NUMBER,
          CONTAINER_SIZE,
          CONTAINER_TYPE,          
          CONTAINER_OWNER
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D0',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C1.LS_EXPECTED_DATE,
          C1.LS_EXPECTED_DATE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          C1.TERM_DESTNAME,
          C1.TERM_DESTADDR1,
          C1.TERM_DESTADDR2,
          C1.TERM_DESTCITY,
          C1.TERM_DESTPROV,
          C1.TERM_DESTPC, 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          '',
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          '',
          '',
          C2.STOP_NO,
          C1.LS_NUM_DEL,
          C2.CONTAINER_NUMBER,
          C2.CONTAINER_SIZE,
          C2.CONTAINER_TYPE,
          C2.CONTAINER_OWNER
        );          
      END FOR;      
    END IF;                    
    IF COALESCE(TERM_ORIG,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,           
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'P' AND X.LD_LEG_ID = S_LEG_ID AND Y.ORIGNAME = T.ORIGNAME AND Y.START_ZONE = T.START_ZONE WITH UR) STOP_NO,
          R.CONTAINER_NUMBER,
          R.CONTAINER_SIZE,
          R.CONTAINER_TYPE,
          C.NAME CONTAINER_OWNER          
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN CONTAINER_TLORDER R ON R.DLID = T.IM_LOADED
          LEFT OUTER JOIN CLIENT C ON C.CLIENT_ID = R.CONTAINER_OWNER
        WHERE
          I.LD_PD = 'P' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG,
          CONTAINER_NUMBER,
          CONTAINER_SIZE,
          CONTAINER_TYPE,
          CONTAINER_OWNER
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P0',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          '',
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU,
          C2.CONTAINER_NUMBER,
          C2.CONTAINER_SIZE,
          C2.CONTAINER_TYPE,
          C2.CONTAINER_OWNER
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'D' AND X.LD_LEG_ID = S_LEG_ID AND Y.DESTNAME = T.DESTNAME AND Y.END_ZONE = T.END_ZONE WITH UR) STOP_NO,
          R.CONTAINER_NUMBER,
          R.CONTAINER_SIZE,
          R.CONTAINER_TYPE,
          C.NAME CONTAINER_OWNER          
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN CONTAINER_TLORDER R ON R.DLID = T.IM_LOADED
          LEFT OUTER JOIN CLIENT C ON C.CLIENT_ID = R.CONTAINER_OWNER
        WHERE
          I.LD_PD = 'D' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG,
          CONTAINER_NUMBER,
          CONTAINER_SIZE,
          CONTAINER_TYPE,
          CONTAINER_OWNER
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D0',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          '',
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_DEL,
          C2.CONTAINER_NUMBER,
          C2.CONTAINER_SIZE,
          C2.CONTAINER_TYPE,
          C2.CONTAINER_OWNER
        );          
      END FOR;         
    END IF;     
    IF COALESCE(TERM_ORIG,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (R.DESC || ': ' || R.TRACE_NUMBER) DESCRIPTION,
          1 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN TRACE R ON R.DETAIL_NUMBER = T.DETAIL_LINE_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID 
          AND R.TRACE_TYPE IN ('B', 'P', 'K', 'S', 'V', '1')
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MIN(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'P' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        ORDER BY 
          R.TRACE_TYPE, R.TRACE_NUMBER
        WITH UR          
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P1',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C1.LS_PLANNED_DEPARTURE,
          C1.LS_PLANNED_DEPARTURE,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          C1.TERM_ORIGNAME,
          C1.TERM_ORIGADDR1,
          C1.TERM_ORIGADDR2,
          C1.TERM_ORIGCITY,
          C1.TERM_ORIGPROV,
          C1.TERM_ORIGPC, 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          '',
          '',
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,           
          (R.DESC || ': ' || R.TRACE_NUMBER) DESCRIPTION,
          9999 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN TRACE R ON R.DETAIL_NUMBER = T.DETAIL_LINE_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID 
          AND R.TRACE_TYPE IN ('B', 'P', 'K', 'S', 'V', '2')
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MAX(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'D' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        ORDER BY 
          R.TRACE_TYPE, R.TRACE_NUMBER
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D1',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C1.LS_EXPECTED_DATE,
          C1.LS_EXPECTED_DATE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          C1.TERM_DESTNAME,
          C1.TERM_DESTADDR1,
          C1.TERM_DESTADDR2,
          C1.TERM_DESTCITY,
          C1.TERM_DESTPROV,
          C1.TERM_DESTPC, 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          '',
          '',
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );          
      END FOR;      
    END IF;                    
    IF COALESCE(TERM_ORIG,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER, 
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,           
          (R.DESC || ': ' || R.TRACE_NUMBER) DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'P' AND X.LD_LEG_ID = S_LEG_ID AND Y.ORIGNAME = T.ORIGNAME AND Y.START_ZONE = T.START_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN TRACE R ON R.DETAIL_NUMBER = T.DETAIL_LINE_ID
        WHERE
          I.LD_PD = 'P' 
          AND I.LD_LEG_ID = S_LEG_ID 
          AND R.TRACE_TYPE IN ('B', 'P', 'K', 'S', 'V', '1')
          AND I.LD_TYPE = 'F'
        ORDER BY 
          R.TRACE_TYPE, R.TRACE_NUMBER
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P1',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (R.DESC || ': ' || R.TRACE_NUMBER) DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'D' AND X.LD_LEG_ID = S_LEG_ID AND Y.DESTNAME = T.DESTNAME AND Y.END_ZONE = T.END_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN TRACE R ON R.DETAIL_NUMBER = T.DETAIL_LINE_ID
        WHERE
          I.LD_PD = 'D' 
          AND I.LD_LEG_ID = S_LEG_ID 
          AND R.TRACE_TYPE IN ('B', 'P', 'K', 'S', 'V', '2')
          AND I.LD_TYPE = 'F'
        ORDER BY 
          R.TRACE_TYPE, R.TRACE_NUMBER
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D1',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );          
      END FOR;         
    END IF;     
    IF COALESCE(TERM_ORIG,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          S.INSTRUCTION DESCRIPTION,
          1 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN TLSHIPINSTRUCT R ON R.ORDER_ID = T.DETAIL_LINE_ID
          INNER JOIN SHIPINSTRUCT S ON S.INSTRUCTION_ID = R.INSTRUCTION_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID 
          AND S.APPLIES_TO IN ('B', 'P')
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MIN(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'P' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        ORDER BY 
          S.INSTRUCTION 
        WITH UR         
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P2',
          1,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C1.LS_PLANNED_DEPARTURE,
          C1.LS_PLANNED_DEPARTURE,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          C1.TERM_ORIGNAME,
          C1.TERM_ORIGADDR1,
          C1.TERM_ORIGADDR2,
          C1.TERM_ORIGCITY,
          C1.TERM_ORIGPROV,
          C1.TERM_ORIGPC, 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          '',
          '',
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;               
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          S.INSTRUCTION DESCRIPTION,
          9999 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
          INNER JOIN TLSHIPINSTRUCT R ON R.ORDER_ID = T.DETAIL_LINE_ID
          INNER JOIN SHIPINSTRUCT S ON S.INSTRUCTION_ID = R.INSTRUCTION_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID 
          AND S.APPLIES_TO IN ('B', 'D')
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MAX(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'D' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        ORDER BY 
          S.INSTRUCTION  
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D2',
          9999,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C1.LS_EXPECTED_DATE,
          C1.LS_EXPECTED_DATE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          C1.TERM_DESTNAME,
          C1.TERM_DESTADDR1,
          C1.TERM_DESTADDR2,
          C1.TERM_DESTCITY,
          C1.TERM_DESTPROV,
          C1.TERM_DESTPC, 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          '',
          '',
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );          
      END FOR; 
    END IF;                    
    IF COALESCE(TERM_ORIG,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          S.INSTRUCTION DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'P' AND X.LD_LEG_ID = S_LEG_ID AND Y.ORIGNAME = T.ORIGNAME AND Y.START_ZONE = T.START_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN TLSHIPINSTRUCT R ON R.ORDER_ID = T.DETAIL_LINE_ID
          INNER JOIN SHIPINSTRUCT S ON S.INSTRUCTION_ID = R.INSTRUCTION_ID
        WHERE
          I.LD_PD = 'P' 
          AND I.LD_LEG_ID = S_LEG_ID 
          AND S.APPLIES_TO IN ('B', 'P')
          AND I.LD_TYPE = 'F'
        ORDER BY 
          S.INSTRUCTION
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'P2',
          C2.LD_PD_ORDER,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_PU
        );          
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          S.INSTRUCTION DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'D' AND X.LD_LEG_ID = S_LEG_ID AND Y.DESTNAME = T.DESTNAME AND Y.END_ZONE = T.END_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
          INNER JOIN TLSHIPINSTRUCT R ON R.ORDER_ID = T.DETAIL_LINE_ID
          INNER JOIN SHIPINSTRUCT S ON S.INSTRUCTION_ID = R.INSTRUCTION_ID
        WHERE
          I.LD_PD = 'D' 
          AND I.LD_LEG_ID = S_LEG_ID 
          AND S.APPLIES_TO IN ('B', 'D')
          AND I.LD_TYPE = 'F'
        ORDER BY 
          S.INSTRUCTION
        WITH UR
      DO        
        INSERT INTO CGTT_TEMP_IPCONT_RSLT(
          LEG_ID,
          LD_PD,
          LD_PD_ORDER,
          DETAIL_LINE_ID,
          BILL_NUMBER, 
          PICK_UP_BY,
          PICK_UP_BY_END,
          DELIVER_BY,
          DELIVER_BY_END,
          TERM_ORIGNAME,
          TERM_ORIGADDR1,
          TERM_ORIGADDR2,
          TERM_ORIGCITY,
          TERM_ORIGPROV,
          TERM_ORIGPC, 
          ORIGNAME,
          ORIGADDR1,
          ORIGADDR2,
          ORIGCITY,
          ORIGPROV,
          ORIGPC,
          ORIGCONTACT,
          ORIGPHONE,
          TERM_DESTNAME,
          TERM_DESTADDR1,
          TERM_DESTADDR2,
          TERM_DESTCITY,
          TERM_DESTPROV,
          TERM_DESTPC, 
          DESTNAME,
          DESTADDR1,
          DESTADDR2,
          DESTCITY,
          DESTPROV,
          DESTPC,
          DESTCONTACT,
          DESTPHONE,
          DESCRIPTION,
          PIECES,
          PALLETS,
          WEIGHT,
          WEIGHT_UNITS,
          LENGTH_1,
          LENGTH_UNITS,    
          WIDTH,
          WIDTH_UNITS,    
          HEIGHT,
          HEIGHT_UNITS,
          CUBE,
          CUBE_UNITS,  
          TEMPERATURE,
          TEMP_CONTROLLED,
          TEMPERATURE_UNITS,
          TARP,
          HIGH_VALUE,
          DANGEROUS_GOODS,
          CUSTOMS_NAME,
          CUSTOMS_PHONE,    
          CUSTOMS_FAX,
          PICK_UP_APPT_REQ,
          PICK_UP_APPT_MADE,
          DELIVERY_APPT_REQ,
          DELIVERY_APPT_MADE,
          STOP_NO,
          FBS_ON_LEG
        ) 
        VALUES(
          C1.LS_LEG_ID,
          'D2',
          C2.LD_PD_ORDER,
          C2.DETAIL_LINE_ID,
          C2.BILL_NUMBER, 
          C2.PICK_UP_BY,
          C2.PICK_UP_BY_END,
          C2.DELIVER_BY,
          C2.DELIVER_BY_END,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.ORIGNAME,
          C2.ORIGADDR1,
          C2.ORIGADDR2,
          C2.ORIGCITY,
          C2.ORIGPROV,
          C2.ORIGPC,
          C2.ORIGCONTACT,
          C2.ORIGPHONE,
          '',
          '',
          '',
          '',
          '',
          '', 
          C2.DESTNAME,
          C2.DESTADDR1,
          C2.DESTADDR2,
          C2.DESTCITY,
          C2.DESTPROV,
          C2.DESTPC,
          C2.DESTCONTACT,
          C2.DESTPHONE,
          C2.DESCRIPTION,
          0,
          0,
          0,
          '',
          0,
          '',    
          0,
          '',    
          0,
          '',
          0,
          '',  
          0,
          '',
          '',
          '',
          '',
          '',
          '',
          '',    
          '',
          C2.PICK_UP_APPT_REQ,
          C2.PICK_UP_APPT_MADE,
          C2.DELIVERY_APPT_REQ,
          C2.DELIVERY_APPT_MADE,
          C2.STOP_NO,
          C1.LS_NUM_DEL
        );          
      END FOR;      
    END IF; 
    IF COALESCE(TERM_ORIG,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT THE_NOTE FROM NOTES WHERE NOTE_TYPE = 'D' AND PROG_TABLE = 'TLORDER' AND ID_KEY = CHAR(T.DETAIL_LINE_ID) FETCH FIRST ROW ONLY WITH UR) DESCRIPTION,
          1 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MIN(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'P' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        WITH UR
      DO        
        IF LENGTH(C2.DESCRIPTION) <> 0 THEN
          INSERT INTO CGTT_TEMP_IPCONT_RSLT(
            LEG_ID,
            LD_PD,
            LD_PD_ORDER,
            DETAIL_LINE_ID,
            BILL_NUMBER, 
            PICK_UP_BY,
            PICK_UP_BY_END,
            DELIVER_BY,
            DELIVER_BY_END,
            TERM_ORIGNAME,
            TERM_ORIGADDR1,
            TERM_ORIGADDR2,
            TERM_ORIGCITY,
            TERM_ORIGPROV,
            TERM_ORIGPC, 
            ORIGNAME,
            ORIGADDR1,
            ORIGADDR2,
            ORIGCITY,
            ORIGPROV,
            ORIGPC,
            ORIGCONTACT,
            ORIGPHONE,
            TERM_DESTNAME,
            TERM_DESTADDR1,
            TERM_DESTADDR2,
            TERM_DESTCITY,
            TERM_DESTPROV,
            TERM_DESTPC, 
            DESTNAME,
            DESTADDR1,
            DESTADDR2,
            DESTCITY,
            DESTPROV,
            DESTPC,
            DESTCONTACT,
            DESTPHONE,
            DESCRIPTION,
            PIECES,
            PALLETS,
            WEIGHT,
            WEIGHT_UNITS,
            LENGTH_1,
            LENGTH_UNITS,    
            WIDTH,
            WIDTH_UNITS,    
            HEIGHT,
            HEIGHT_UNITS,
            CUBE,
            CUBE_UNITS,  
            TEMPERATURE,
            TEMP_CONTROLLED,
            TEMPERATURE_UNITS,
            TARP,
            HIGH_VALUE,
            DANGEROUS_GOODS,
            CUSTOMS_NAME,
            CUSTOMS_PHONE,    
            CUSTOMS_FAX,
            PICK_UP_APPT_REQ,
            PICK_UP_APPT_MADE,
            DELIVERY_APPT_REQ,
            DELIVERY_APPT_MADE,
            STOP_NO,
            FBS_ON_LEG
          ) 
          VALUES(
            C1.LS_LEG_ID,
            'P3',
            1,
            C2.DETAIL_LINE_ID,
            C2.BILL_NUMBER, 
            C1.LS_PLANNED_DEPARTURE,
            C1.LS_PLANNED_DEPARTURE,
            C2.DELIVER_BY,
            C2.DELIVER_BY_END,
            C1.TERM_ORIGNAME,
            C1.TERM_ORIGADDR1,
            C1.TERM_ORIGADDR2,
            C1.TERM_ORIGCITY,
            C1.TERM_ORIGPROV,
            C1.TERM_ORIGPC, 
            C2.ORIGNAME,
            C2.ORIGADDR1,
            C2.ORIGADDR2,
            C2.ORIGCITY,
            C2.ORIGPROV,
            C2.ORIGPC,
            C2.ORIGCONTACT,
            C2.ORIGPHONE,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.DESTNAME,
            C2.DESTADDR1,
            C2.DESTADDR2,
            C2.DESTCITY,
            C2.DESTPROV,
            C2.DESTPC,
            C2.DESTCONTACT,
            C2.DESTPHONE,
            C2.DESCRIPTION,
            0,
            0,
            0,
            '',
            0,
            '',    
            0,
            '',    
            0,
            '',
            0,
            '',  
            0,
            '',
            '',
            '',
            '',
            '',
            '',
            '',    
            '',
            '',
            '',
            C2.DELIVERY_APPT_REQ,
            C2.DELIVERY_APPT_MADE,
            C2.STOP_NO,
            C1.LS_NUM_PU
          );          
        END IF;
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'True' THEN
      FOR C2 AS
        SELECT
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT THE_NOTE FROM NOTES WHERE NOTE_TYPE = 'D' AND PROG_TABLE = 'TLORDER' AND ID_KEY = CHAR(T.DETAIL_LINE_ID) FETCH FIRST ROW ONLY WITH UR) DESCRIPTION,
          9999 STOP_NO
        FROM    
          ILEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.ILD_FB_ID
        WHERE
          I.ILD_LEG_ID = S_LEG_ID
          AND I.ILD_RES_TYPE = 'F'
          AND (C1.LS_LEG_SEQ = (SELECT MAX(LS_LEG_SEQ) FROM LEGSUM WHERE LS_TRIP_NUMBER = I.ILD_TRIP_NUMBER AND LS_INTERLINER = C1.LS_INTERLINER) OR EXISTS(SELECT LD_LEG_ID FROM LEGDTL WHERE LD_PD = 'D' AND LD_TYPE = 'F' AND LD_FB_ID = I.ILD_FB_ID AND LD_LEG_ID = I.ILD_LEG_ID))
        WITH UR
      DO        
        IF LENGTH(C2.DESCRIPTION) <> 0 THEN
          INSERT INTO CGTT_TEMP_IPCONT_RSLT(
            LEG_ID,
            LD_PD,
            LD_PD_ORDER,
            DETAIL_LINE_ID,
            BILL_NUMBER, 
            PICK_UP_BY,
            PICK_UP_BY_END,
            DELIVER_BY,
            DELIVER_BY_END,
            TERM_ORIGNAME,
            TERM_ORIGADDR1,
            TERM_ORIGADDR2,
            TERM_ORIGCITY,
            TERM_ORIGPROV,
            TERM_ORIGPC, 
            ORIGNAME,
            ORIGADDR1,
            ORIGADDR2,
            ORIGCITY,
            ORIGPROV,
            ORIGPC,
            ORIGCONTACT,
            ORIGPHONE,
            TERM_DESTNAME,
            TERM_DESTADDR1,
            TERM_DESTADDR2,
            TERM_DESTCITY,
            TERM_DESTPROV,
            TERM_DESTPC, 
            DESTNAME,
            DESTADDR1,
            DESTADDR2,
            DESTCITY,
            DESTPROV,
            DESTPC,
            DESTCONTACT,
            DESTPHONE,
            DESCRIPTION,
            PIECES,
            PALLETS,
            WEIGHT,
            WEIGHT_UNITS,
            LENGTH_1,
            LENGTH_UNITS,    
            WIDTH,
            WIDTH_UNITS,    
            HEIGHT,
            HEIGHT_UNITS,
            CUBE,
            CUBE_UNITS,  
            TEMPERATURE,
            TEMP_CONTROLLED,
            TEMPERATURE_UNITS,
            TARP,
            HIGH_VALUE,
            DANGEROUS_GOODS,
            CUSTOMS_NAME,
            CUSTOMS_PHONE,    
            CUSTOMS_FAX,
            PICK_UP_APPT_REQ,
            PICK_UP_APPT_MADE,
            DELIVERY_APPT_REQ,
            DELIVERY_APPT_MADE,
            STOP_NO,
            FBS_ON_LEG
          ) 
          VALUES(
            C1.LS_LEG_ID,
            'D3',
            9999,
            C2.DETAIL_LINE_ID,
            C2.BILL_NUMBER, 
            C2.PICK_UP_BY,
            C2.PICK_UP_BY_END,
            C1.LS_EXPECTED_DATE,
            C1.LS_EXPECTED_DATE,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.ORIGNAME,
            C2.ORIGADDR1,
            C2.ORIGADDR2,
            C2.ORIGCITY,
            C2.ORIGPROV,
            C2.ORIGPC,
            C2.ORIGCONTACT,
            C2.ORIGPHONE,
            C1.TERM_DESTNAME,
            C1.TERM_DESTADDR1,
            C1.TERM_DESTADDR2,
            C1.TERM_DESTCITY,
            C1.TERM_DESTPROV,
            C1.TERM_DESTPC, 
            C2.DESTNAME,
            C2.DESTADDR1,
            C2.DESTADDR2,
            C2.DESTCITY,
            C2.DESTPROV,
            C2.DESTPC,
            C2.DESTCONTACT,
            C2.DESTPHONE,
            C2.DESCRIPTION,
            0,
            0,
            0,
            '',
            0,
            '',    
            0,
            '',    
            0,
            '',
            0,
            '',  
            0,
            '',
            '',
            '',
            '',
            '',
            '',
            '',    
            '',
            PICK_UP_APPT_REQ,
            PICK_UP_APPT_MADE,
            '',
            '',
            C2.STOP_NO,
            C1.LS_NUM_DEL
          );          
        END IF;
      END FOR;      
    END IF;                    
    IF COALESCE(TERM_ORIG,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT THE_NOTE FROM NOTES WHERE NOTE_TYPE = 'D' AND PROG_TABLE = 'TLORDER' AND ID_KEY = CHAR(T.DETAIL_LINE_ID) FETCH FIRST ROW ONLY WITH UR) DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'P' AND X.LD_LEG_ID = S_LEG_ID AND Y.ORIGNAME = T.ORIGNAME AND Y.START_ZONE = T.START_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
        WHERE
          I.LD_PD = 'P' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        IF LENGTH(C2.DESCRIPTION) <> 0 THEN
          INSERT INTO CGTT_TEMP_IPCONT_RSLT(
            LEG_ID,
            LD_PD,
            LD_PD_ORDER,
            DETAIL_LINE_ID,
            BILL_NUMBER, 
            PICK_UP_BY,
            PICK_UP_BY_END,
            DELIVER_BY,
            DELIVER_BY_END,
            TERM_ORIGNAME,
            TERM_ORIGADDR1,
            TERM_ORIGADDR2,
            TERM_ORIGCITY,
            TERM_ORIGPROV,
            TERM_ORIGPC, 
            ORIGNAME,
            ORIGADDR1,
            ORIGADDR2,
            ORIGCITY,
            ORIGPROV,
            ORIGPC,
            ORIGCONTACT,
            ORIGPHONE,
            TERM_DESTNAME,
            TERM_DESTADDR1,
            TERM_DESTADDR2,
            TERM_DESTCITY,
            TERM_DESTPROV,
            TERM_DESTPC, 
            DESTNAME,
            DESTADDR1,
            DESTADDR2,
            DESTCITY,
            DESTPROV,
            DESTPC,
            DESTCONTACT,
            DESTPHONE,
            DESCRIPTION,
            PIECES,
            PALLETS,
            WEIGHT,
            WEIGHT_UNITS,
            LENGTH_1,
            LENGTH_UNITS,    
            WIDTH,
            WIDTH_UNITS,    
            HEIGHT,
            HEIGHT_UNITS,
            CUBE,
            CUBE_UNITS,  
            TEMPERATURE,
            TEMP_CONTROLLED,
            TEMPERATURE_UNITS,
            TARP,
            HIGH_VALUE,
            DANGEROUS_GOODS,
            CUSTOMS_NAME,
            CUSTOMS_PHONE,    
            CUSTOMS_FAX,
            PICK_UP_APPT_REQ,
            PICK_UP_APPT_MADE,
            DELIVERY_APPT_REQ,
            DELIVERY_APPT_MADE,
            STOP_NO,
            FBS_ON_LEG
          ) 
          VALUES(
            C1.LS_LEG_ID,
            'P3',
            C2.LD_PD_ORDER,
            C2.DETAIL_LINE_ID,
            C2.BILL_NUMBER, 
            C2.PICK_UP_BY,
            C2.PICK_UP_BY_END,
            C2.DELIVER_BY,
            C2.DELIVER_BY_END,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.ORIGNAME,
            C2.ORIGADDR1,
            C2.ORIGADDR2,
            C2.ORIGCITY,
            C2.ORIGPROV,
            C2.ORIGPC,
            C2.ORIGCONTACT,
            C2.ORIGPHONE,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.DESTNAME,
            C2.DESTADDR1,
            C2.DESTADDR2,
            C2.DESTCITY,
            C2.DESTPROV,
            C2.DESTPC,
            C2.DESTCONTACT,
            C2.DESTPHONE,
            C2.DESCRIPTION,
            0,
            0,
            0,
            '',
            0,
            '',    
            0,
            '',    
            0,
            '',
            0,
            '',  
            0,
            '',
            '',
            '',
            '',
            '',
            '',
            '',    
            '',
            C2.PICK_UP_APPT_REQ,
            C2.PICK_UP_APPT_MADE,
            C2.DELIVERY_APPT_REQ,
            C2.DELIVERY_APPT_MADE,
            C2.STOP_NO,
            C1.LS_NUM_PU
          );          
        END IF;
      END FOR;      
    END IF;          
    IF COALESCE(TERM_DEST,'') = 'False' THEN
      FOR C2 AS
        SELECT
          I.LD_PD,
          I.LD_PD_ORDER,
          T.DETAIL_LINE_ID,
          T.BILL_NUMBER,
          T.PICK_UP_BY,
          T.PICK_UP_BY_END,
          T.DELIVER_BY,
          T.DELIVER_BY_END,
          T.ORIGNAME,
          T.ORIGADDR1,
          T.ORIGADDR2,
          T.ORIGCITY,
          T.ORIGPROV,
          T.ORIGPC,
          T.ORIGCONTACT,
          T.ORIGPHONE,
          T.DESTNAME,
          T.DESTADDR1,
          T.DESTADDR2,
          T.DESTCITY,
          T.DESTPROV,
          T.DESTPC,
          T.DESTCONTACT,
          T.DESTPHONE,
          T.PICK_UP_APPT_REQ,
          T.PICK_UP_APPT_MADE,
          T.DELIVERY_APPT_REQ,
          T.DELIVERY_APPT_MADE,
          (SELECT THE_NOTE FROM NOTES WHERE NOTE_TYPE = 'D' AND PROG_TABLE = 'TLORDER' AND ID_KEY = CHAR(T.DETAIL_LINE_ID) FETCH FIRST ROW ONLY WITH UR) DESCRIPTION,
          (SELECT MIN(LD_PD_ORDER) FROM LEGDTL X INNER JOIN TLORDER Y ON Y.DETAIL_LINE_ID = X.LD_FB_ID WHERE X.LD_TYPE = 'F' AND X.LD_PD = 'D' AND X.LD_LEG_ID = S_LEG_ID AND Y.DESTNAME = T.DESTNAME AND Y.END_ZONE = T.END_ZONE WITH UR) STOP_NO
        FROM    
          LEGDTL I
          INNER JOIN TLORDER T ON T.DETAIL_LINE_ID = I.LD_FB_ID
        WHERE
          I.LD_PD = 'D' 
          AND I.LD_LEG_ID = S_LEG_ID
          AND I.LD_TYPE = 'F'
        WITH UR
      DO        
        IF LENGTH(C2.DESCRIPTION) <> 0 THEN
          INSERT INTO CGTT_TEMP_IPCONT_RSLT(
            LEG_ID,
            LD_PD,
            LD_PD_ORDER,
            DETAIL_LINE_ID,
            BILL_NUMBER, 
            PICK_UP_BY,
            PICK_UP_BY_END,
            DELIVER_BY,
            DELIVER_BY_END,
            TERM_ORIGNAME,
            TERM_ORIGADDR1,
            TERM_ORIGADDR2,
            TERM_ORIGCITY,
            TERM_ORIGPROV,
            TERM_ORIGPC, 
            ORIGNAME,
            ORIGADDR1,
            ORIGADDR2,
            ORIGCITY,
            ORIGPROV,
            ORIGPC,
            ORIGCONTACT,
            ORIGPHONE,
            TERM_DESTNAME,
            TERM_DESTADDR1,
            TERM_DESTADDR2,
            TERM_DESTCITY,
            TERM_DESTPROV,
            TERM_DESTPC, 
            DESTNAME,
            DESTADDR1,
            DESTADDR2,
            DESTCITY,
            DESTPROV,
            DESTPC,
            DESTCONTACT,
            DESTPHONE,
            DESCRIPTION,
            PIECES,
            PALLETS,
            WEIGHT,
            WEIGHT_UNITS,
            LENGTH_1,
            LENGTH_UNITS,    
            WIDTH,
            WIDTH_UNITS,    
            HEIGHT,
            HEIGHT_UNITS,
            CUBE,
            CUBE_UNITS,  
            TEMPERATURE,
            TEMP_CONTROLLED,
            TEMPERATURE_UNITS,
            TARP,
            HIGH_VALUE,
            DANGEROUS_GOODS,
            CUSTOMS_NAME,
            CUSTOMS_PHONE,    
            CUSTOMS_FAX,
            PICK_UP_APPT_REQ,
            PICK_UP_APPT_MADE,
            DELIVERY_APPT_REQ,
            DELIVERY_APPT_MADE,
            STOP_NO,
            FBS_ON_LEG
          ) 
          VALUES(
            C1.LS_LEG_ID,
            'D3',
            C2.LD_PD_ORDER,
            C2.DETAIL_LINE_ID,
            C2.BILL_NUMBER, 
            C2.PICK_UP_BY,
            C2.PICK_UP_BY_END,
            C2.DELIVER_BY,
            C2.DELIVER_BY_END,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.ORIGNAME,
            C2.ORIGADDR1,
            C2.ORIGADDR2,
            C2.ORIGCITY,
            C2.ORIGPROV,
            C2.ORIGPC,
            C2.ORIGCONTACT,
            C2.ORIGPHONE,
            '',
            '',
            '',
            '',
            '',
            '', 
            C2.DESTNAME,
            C2.DESTADDR1,
            C2.DESTADDR2,
            C2.DESTCITY,
            C2.DESTPROV,
            C2.DESTPC,
            C2.DESTCONTACT,
            C2.DESTPHONE,
            C2.DESCRIPTION,
            0,
            0,
            0,
            '',
            0,
            '',    
            0,
            '',    
            0,
            '',
            0,
            '',  
            0,
            '',
            '',
            '',
            '',
            '',
            '',
            '',    
            '',
            C2.PICK_UP_APPT_REQ,
            C2.PICK_UP_APPT_MADE,
            C2.DELIVERY_APPT_REQ,
            C2.DELIVERY_APPT_MADE,
            C2.STOP_NO,
            C1.LS_NUM_DEL
          );                    
        END IF;
      END FOR;      
    END IF;             
  END FOR;
  BEGIN
    DECLARE C_RESULT_SET CURSOR WITH RETURN TO CALLER FOR
      SELECT X.*,
      (select USER2 FROM TLORDER_ALL WHERE DETAIL_LINE_ID = X.DETAIL_LINE_ID) TLUSER2,
      (select SERVICE_LEVEL FROM TLORDER_ALL WHERE DETAIL_LINE_ID = X.DETAIL_LINE_ID) SERVICE,
      (select CUSTOMS_CONTACT FROM TLORDER_CUSTOMS WHERE DETAIL_LINE_ID = X.DETAIL_LINE_ID AND DEFAULT_BROKER = 'True') CUSTOMS_CONTACT
       FROM CGTT_TEMP_IPCONT_RSLT X;
    OPEN C_RESULT_SET;
  END;
END


