SELECT 
  T.INTERFACE_STATUS_F   AS CNTBTCH,
  ROW_NUMBER() OVER(
    PARTITION BY T.INTERFACE_STATUS_F 
    ORDER BY T.INTERFACE_STATUS_F, C.USER3, T.BILL_NUMBER
  )                       AS CNTITEM,
  C.USER3                AS IDCUST,
  T.BILL_NUMBER          AS IDINVC,
  '1'                    AS TEXTTRX,
  (
    SELECT TRACE_NUMBER 
    FROM TRACE 
    WHERE TRACE_TYPE = 'P' 
      AND DETAIL_NUMBER = T.DETAIL_LINE_ID 
    LIMIT 1
  )                       AS CUSTPO,
  T.TOTAL_CHARGES        AS AMTINVCTOT,
  '1'                    AS SWMANTX
FROM TLORDER T
JOIN CLIENT C 
  ON C.CLIENT_ID = T.BILL_TO_CODE
WHERE T.INTERFACE_STATUS_F > 0
  AND T.EXTRA_STOPS <> 'Child'
  AND T.INTERFACE_STATUS_F = :AUDIT
  AND EXISTS (
    SELECT 1
    FROM BILLGL B
    WHERE B.DETAIL_LINE_ID = T.DETAIL_LINE_ID
      --AND B.ACCT_CODE LIKE '01%'
	  AND B.ACCT_CODE IN (
        '02-2200-00',
        '02-2210-00',
        '02-3000-00',
        '02-3100-00'
		)
  )
ORDER BY 1, 3, 4;
